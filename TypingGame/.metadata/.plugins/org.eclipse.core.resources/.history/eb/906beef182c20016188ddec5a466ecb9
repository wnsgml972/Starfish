
package panel;

import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;

import javax.sound.midi.Soundbank;
import javax.sound.sampled.AudioFormat;
import javax.sound.sampled.AudioInputStream;
import javax.sound.sampled.AudioSystem;
import javax.sound.sampled.Clip;
import javax.sound.sampled.DataLine;
import javax.sound.sampled.SourceDataLine;
import javax.swing.*;

import globalNum.GlobalNum;
import image.ImageCollection;
import panel.PanelManager;

public class IntroPanel extends JPanel 
{
	private PanelManager panelManager;
	
	private JButton gameStartBtn = new JButton(ImageCollection.normalGameStart);
	private JButton gameExplanationBtn = new JButton(ImageCollection.normalGameExplanation);
	private JButton gameLevelChoiceBtn = new JButton(ImageCollection.normalLevelChoice);
	private JButton gameRankBtn = new JButton(ImageCollection.normalRanking);
	private JButton gameExitBtn = new JButton(ImageCollection.normalExit);	
	
	
	private LevelChoiceDialog levelChoiceDialog;	
	private DownStar downStar;
	
	public IntroPanel(PanelManager panelManager) 
	{
		this.panelManager = panelManager;
		setSize(1100, 800);
		setLayout(null);
		SoundClass sounds = new SoundClass();
		sounds.play("1.mp3");
		gameStartBtn.setBounds(440, 275, 210, 45);		
		gameExplanationBtn.setBounds(440, 340, 210, 45);
		gameLevelChoiceBtn.setBounds(440, 405, 210, 45);
		gameRankBtn.setBounds(440, 470, 210, 45);
		gameExitBtn.setBounds(440, 535, 210, 45);

		gameStartBtn.setRolloverIcon(ImageCollection.overGameStart);		
		gameExplanationBtn.setRolloverIcon(ImageCollection.overGameExplanation);
		gameLevelChoiceBtn.setRolloverIcon(ImageCollection.overLevelChoice);
		gameRankBtn.setRolloverIcon(ImageCollection.overRanking);
		gameExitBtn.setRolloverIcon(ImageCollection.overExit);
		
		gameStartBtn.addActionListener(new ActionListener() 
		{
			@Override
			public void actionPerformed(ActionEvent e) {
				downStar.finish();
				panelManager.setContentPane(GlobalNum.GAME);
			}
		});
		gameExplanationBtn.addActionListener(new ActionListener()
		{
			@Override
			public void actionPerformed(ActionEvent e) {
				downStar.finish();
				panelManager.setContentPane(GlobalNum.EXPLANATION);
			}
		});
		gameLevelChoiceBtn.addActionListener(new ActionListener() 
		{
			@Override
			public void actionPerformed(ActionEvent e) {
				levelChoiceDialog = new LevelChoiceDialog(panelManager.getMainFrame());
				levelChoiceDialog.setVisible(true);
			}
		});
		gameRankBtn.addActionListener(new ActionListener() 
		{
			@Override
			public void actionPerformed(ActionEvent e) {
				downStar.finish();
				panelManager.setContentPane(GlobalNum.RANKING);
			}
		});
		gameExitBtn.addActionListener(new ActionListener() 
		{
			@Override
			public void actionPerformed(ActionEvent e) {
				System.exit(0);
			}
		});

		add(gameStartBtn);
		add(gameExplanationBtn);
		add(gameLevelChoiceBtn);
		add(gameRankBtn);
		add(gameExitBtn);
	}

	public void downStarStart()
	{
		downStar = new DownStar(this);
		downStar.start();
	}

	public void paintComponent(Graphics g) 
	{
		super.paintComponent(g);
		g.drawImage(ImageCollection.spaceImg, 0, 0, getWidth(), getHeight(), this);

		g.setFont(new Font("궁서", Font.ITALIC, 50));
		g.setColor(Color.YELLOW);
		g.drawString("Defend The Earth", 310, 200);

		g.setColor(Color.white);
		g.setFont(new Font("Arial Black", Font.ITALIC, 15));
		g.drawString("Produced by Kim Jun Hee, Choi Yong Seok", 700, 730);
	}
	
	
	public class LevelChoiceDialog extends JDialog 
	{
		JButton levelBtn[] = new JButton[5];
		JPanel myPanel = new JPanel() {
			public void paintComponent(Graphics g) {
				super.paintComponent(g);
				g.drawImage(ImageCollection.spaceImg, 0, 0, getWidth(), getHeight(), this);
			}
		};
		
		public LevelChoiceDialog(JFrame mainFrame) {
			super(mainFrame, "Level Choice", true);
			setContentPane(myPanel);
			myPanel.setLayout(null);
			levelBtn[0] = new JButton(ImageCollection.normalLevel1);
			levelBtn[1] = new JButton(ImageCollection.normalLevel2);
			levelBtn[2] = new JButton(ImageCollection.normalLevel3);
			levelBtn[3] = new JButton(ImageCollection.normalLevel4);
			levelBtn[4] = new JButton(ImageCollection.normalLevel5);
			for (int i = 0; i < levelBtn.length; i++)
			{
				levelBtn[i].setSize(200, 45);
				levelBtn[i].setLocation(43, 20 + (i * 55));
				levelBtn[i].setName("level" + (i + 1));
				myPanel.add(levelBtn[i]);
				levelBtn[i].addActionListener(new MyActionListener());
			}
			levelBtn[0].setRolloverIcon(ImageCollection.overLevel1);
			levelBtn[1].setRolloverIcon(ImageCollection.overLevel2);
			levelBtn[2].setRolloverIcon(ImageCollection.overLevel3);
			levelBtn[3].setRolloverIcon(ImageCollection.overLevel4);
			levelBtn[4].setRolloverIcon(ImageCollection.overLevel5);
			setLocation(mainFrame.getLocation().x + 400, mainFrame.getLocation().y + 200);
			setSize(300, 350);
		}
		class MyActionListener implements ActionListener 
		{
			public void actionPerformed(ActionEvent e) {
				JButton btn = (JButton) e.getSource();
				String myLevel = btn.getName();
				if (myLevel.equals("level1")) {
					GamePanel.gameLevel = 1;
				} else if (myLevel.equals("level2")) {
					GamePanel.gameLevel = 2;
				} else if (myLevel.equals("level3")) {
					GamePanel.gameLevel = 3;
				} else if (myLevel.equals("level4")) {
					GamePanel.gameLevel = 4;
				} else if (myLevel.equals("level5")) {
					GamePanel.gameLevel = 5;
				}
				levelChoiceDialog.setVisible(false);
			}
		}
	}
	class SoundClass{
		public void play(String fileName){
			try{
				AudioInputStream sound = AudioSystem.getAudioInputStream(new File(fileName));
				AudioFormat audioFormat = sound.getFormat();
			      // 바이트수는 아니고 샘플 프레임수로 나타내지는, 스트림의 길이를 취득
			 
			      DataLine.Info info = new DataLine.Info(SourceDataLine.class,audioFormat);
			      // 단일의 오디오 형식을 포함한 지정한 정보로부터 데이터 라인의 정보 오브젝트를 구축

			      SourceDataLine line = (SourceDataLine) AudioSystem.getLine(info);
			      // 지정된 Line.Info 오브젝트의 기술에 일치하는 라인을 취득
			      line.open(audioFormat);
			     // 지정된 형식과 지정된 버퍼 사이즈로 라인을 열어, 라인이 필요한 system resource를 획득해 조작 가능
			      line.start();		
			}
			catch(Exception e){}
		}
	}
}